# версия докера.
version: '3'

# сервисы, они же образы (image), которые необходимы для работы проекта. Нюансы по их подключению можно найти на докерхабе, в доках по ним.
# ports - порты на которых будет работать/слушать сервис.
# $ docker exec app_name nginx -s reload - перезагрузить nginx в конкретном контейнере.
# $ docker exec -it project-name bash - подключиться непосредственно к контейнеру, дабы юзать его сервисы, например для настройки локального volums.
# volums - локальная настройка для какого-нибудь сервиса в нутри конкретного контейнера. В случает nginx - указывает ему отрабатывать по заданному
# мною роуту в этом проекте, а не в своём дефолтном на линуксе. А в случае sql - хранит БД локально и не дропает её при уничтожении контейнера или его выключении.
# depends_on - указывает nginx, что работать можно только при наличии образа с pxp, к примеру.
# restart - указывает, что контейнер необходимо всегда перезагружать, если он вдруг навернулся.

services:
  nginx:
    image: nginx:latest
    volumes:
      - ./:/var/www/                                 # как бы директория с проектом на которую указывает роут из кастомного конфига.
      - ./_docker/nginx/conf.d/:/etc/nginx/conf.d/   # перенаправление nginx на мой кастомный конфиг с роутом.
    ports:
      - 8876:80
    container_name: project_nginx
    depends_on:
      - app

  app:
    build:                                 # указываем, что теперь образ и настройка php берётся
      context: .                           # из моего кастомного Dockerfile.
      dockerfile: _docker/app/Dockerfile
    volumes:
      - ./:/var/www/                       # директория с проектом на которую указывает роут из кастомного конфига, для php файлов.
    depends_on:
      - db
    container_name: project_app

  db:                                      # **
    image: mysql:8.0
    restart: always
    volumes:
      - ./tmp/db:/var/lib/mysql            # стандартный путь до БД на линуксе.
    environment:
      MYSQL_DATABASE: demo_docker_lara     # не забыть подключить её в .env !!! **
      MYSQL_ROOT_PASSWORD: root            # **
    ports:
      - 8101:3306
    command: mysqld --character-set-server=utf8 --collation-server=utf8_unicode_ci
    container_name: project_db

